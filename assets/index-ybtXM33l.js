(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const y of s.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&a(y)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const o={x:0,y:0,vx:0,vy:0,speed:220,radius:8},d={};function G(e){return(e||"").toString().toLowerCase()}window.addEventListener("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)&&e.preventDefault(),d[G(e.key)]=!0});window.addEventListener("keyup",e=>{d[G(e.key)]=!1});function Q(e){o.x=e.width*.7,o.y=e.height*.5,o.vx=0,o.vy=0}function Z(e,t){let n=0,a=0;(d.w||d.arrowup)&&(a=-1),(d.s||d.arrowdown)&&(a=1),(d.a||d.arrowleft)&&(n=-1),(d.d||d.arrowright)&&(n=1);const i=window.touchInput||{};i.up&&(a=-1),i.down&&(a=1),i.left&&(n=-1),i.right&&(n=1);const s=Math.hypot(n,a);s>0?(n/=s,a/=s,o.vx=n*o.speed,o.vy=a*o.speed):(o.vx*=.86,o.vy*=.86),o.x+=o.vx*e,o.y+=o.vy*e,o.x=Math.max(o.radius,Math.min(t.width-o.radius,o.x)),o.y=Math.max(o.radius,Math.min(t.height-o.radius,o.y))}let g=[];function K(e,t,n=6){const a=[];for(let i=0;i<n;i++)a.push({x:e-i*16,y:t+(Math.random()*6-3)});return{segments:a,baseSpeed:70,aggro:.18,predictT:.34}}function ee(e){g=[K(e.width*.3,e.height*.5,6)]}function te(e,t,n,a){const i=Math.floor(n/6);for(;g.length<1+i;){const s=Math.random()*a.width*.6+20,y=Math.random()*a.height*.9+10;g.push(K(s,y,6+Math.floor(n/3)))}g.forEach((s,y)=>{const h=s.segments[0],q=s.baseSpeed*(1+(n-1)*.12+y*.05),F=Math.max(.08,s.predictT-(n-1)*.015),U=Math.min(.36,s.aggro+(n-1)*.01),Y=t.x+t.vx*F,J=t.y+t.vy*F;let T=Y-h.x,A=J-h.y;const _=Math.hypot(T,A)||1;T/=_,A/=_,h.x+=T*q*e,h.y+=A*q*e,h.x=Math.max(12,Math.min(a.width-12,h.x)),h.y=Math.max(12,Math.min(a.height-12,h.y));for(let w=1;w<s.segments.length;w++){const $=s.segments[w-1],I=s.segments[w];I.x+=($.x-I.x)*U,I.y+=($.y-I.y)*U}if(Math.random()<.002+n*6e-4){const w=s.segments[s.segments.length-1];s.segments.push({x:w.x-6,y:w.y+2})}})}const l=document.getElementById("game"),r=l.getContext("2d");function z(){l.width=Math.max(600,window.innerWidth-360),l.height=window.innerHeight-60}window.addEventListener("resize",z);z();const ne=document.getElementById("score"),oe=document.getElementById("level"),re=document.getElementById("tleft"),ie=document.getElementById("snakes"),E=document.getElementById("levelPopup"),N=document.getElementById("popupLevel"),ae=document.getElementById("popupCloseBtn");ae.onclick=()=>R();let L=0,v=!1,p=!1,c=0,x=1,b=0,f=3;const V=3,se=20;let m=0;function C(e){m=e}function j(){v=!0,p=!1,c=0,x=1,b=0,f=V,Q(l),ee(l),L=performance.now(),m=0,requestAnimationFrame(S)}function H(){if(!v)return;p=!p;const e=document.getElementById("pauseBtn");e.textContent=p?"Resume":"Pause",p||(L=performance.now(),requestAnimationFrame(S))}function X(){if(v&&!p){if(f<=0)return;for(let e=0;e<30;e++){const t={x:Math.random()*(l.width-60)+30,y:Math.random()*(l.height-60)+30};let n=!0;for(const a of g){for(const i of a.segments)if(Math.hypot(i.x-t.x,i.y-t.y)<70){n=!1;break}if(!n)break}if(n){o.x=t.x,o.y=t.y,o.vx=0,o.vy=0,f--,c=Math.max(0,c-6),C(.6),k();return}}o.x=Math.random()*(l.width-60)+30,o.y=Math.random()*(l.height-60)+30,f--,c=Math.max(0,c-6),C(.6),k();return}if(!v){if(f<=0)return;f--,o.x=Math.random()*(l.width-160)+80,o.y=Math.random()*(l.height-160)+80,o.vx=0,o.vy=0,c=Math.max(0,c-12),v=!0,p=!1,L=performance.now(),C(1),k(),requestAnimationFrame(S);return}}function S(e){if(!v||p)return;const t=Math.min(.05,(e-L)/1e3);L=e,le(t),ue(),requestAnimationFrame(S)}function le(e){if(b+=e,m>0&&(m=Math.max(0,m-e)),Z(e,l),te(e,o,x,l),m<=0)for(const t of g){const n=t.segments[0];if(Math.hypot(n.x-o.x,n.y-o.y)<16+o.radius){v=!1,de();return}}c+=e*12,b>=se&&(b=0,ce()),k()}function ce(){x++,f=V,c+=60,he(x)}function de(){r.fillStyle="rgba(2,6,23,0.7)",r.fillRect(0,0,l.width,l.height),r.fillStyle="#fff",r.font="28px system-ui",r.textAlign="center",r.fillText("Game Over",l.width/2,l.height/2-10),r.font="16px system-ui",r.fillText(`Score: ${Math.floor(c)}  Level: ${x}`,l.width/2,l.height/2+20);try{const e=Number(localStorage.getItem("best")||0);Math.floor(c)>e&&localStorage.setItem("best",Math.floor(c))}catch{}}function k(){ne.textContent=Math.floor(c),oe.textContent=x,re.textContent=f,ie.textContent=g.length}function ue(){r.fillStyle="#071027",r.fillRect(0,0,l.width,l.height);const e=48;r.strokeStyle="rgba(255,255,255,0.02)",r.lineWidth=1;for(let t=0;t<l.width;t+=e)r.beginPath(),r.moveTo(t,0),r.lineTo(t,l.height),r.stroke();for(let t=0;t<l.height;t+=e)r.beginPath(),r.moveTo(0,t),r.lineTo(l.width,t),r.stroke();for(const t of g)for(let n=t.segments.length-1;n>=0;n--){const a=t.segments[n],i=n/Math.max(1,t.segments.length-1),s=12-i*6;r.beginPath(),r.fillStyle=n===0?"rgb(239,71,111)":`rgba(${Math.floor(40+140*(1-i))},${Math.floor(60+150*i)},${Math.floor(30+40*(1-i))},1)`,r.arc(a.x,a.y,s,0,Math.PI*2),r.fill()}if(r.fillStyle="#ffd166",r.beginPath(),r.arc(o.x,o.y,o.radius,0,Math.PI*2),r.fill(),m>0){const t=.12+.12*Math.sin(m*30);r.globalAlpha=t,r.beginPath(),r.arc(o.x,o.y,o.radius*3.6,0,Math.PI*2),r.fill(),r.globalAlpha=1}else r.globalAlpha=.14,r.beginPath(),r.arc(o.x,o.y,o.radius*3.6,0,Math.PI*2),r.fill(),r.globalAlpha=1}function he(e){N.textContent=e,E.classList.remove("hidden"),requestAnimationFrame(()=>E.classList.add("show")),setTimeout(()=>R(),4200)}function R(){E.classList.remove("show"),setTimeout(()=>E.classList.add("hidden"),260)}function M(){const e=new URL(window.location.href);return e.searchParams.set("level",String(x)),e.searchParams.set("score",String(Math.floor(c))),e.toString()}function fe(){const e=new URLSearchParams(window.location.search),t=e.get("level"),n=e.get("score");if(t||n){const a=document.getElementById("shareInput");a&&(a.value=window.location.href),N.textContent=t||"—",E.classList.remove("hidden"),E.classList.add("show"),setTimeout(()=>R(),4200)}}window.__gameAPI={startGame:j,teleport:X,togglePause:H,getShareLinkFromState:M};const pe=document.getElementById("startBtn"),me=document.getElementById("pauseBtn"),ge=document.getElementById("teleBtn"),D=document.getElementById("copyBtn"),ye=document.getElementById("openShareBtn"),we=document.getElementById("shareInput"),O=document.getElementById("popupShareBtn");pe.onclick=()=>j();me.onclick=()=>H();ge.onclick=()=>X();D.onclick=async()=>{try{const e=M();await navigator.clipboard.writeText(e),D.textContent="Copied ✓",setTimeout(()=>D.textContent="Copy link",1500)}catch(e){console.warn("copy failed",e)}};ye.onclick=()=>{const e=M();window.open(e,"_blank")};O.onclick=async()=>{const e=M();try{await navigator.clipboard.writeText(e),O.textContent="Copied ✓",setTimeout(()=>O.textContent="Share Level",1500)}catch(t){console.warn(t)}};setInterval(()=>{try{we.value=M()}catch{}},400);fe();document.querySelector("canvas").addEventListener("click",()=>window.focus());function B(e,t="keydown"){const n=new KeyboardEvent(t,{key:e});window.dispatchEvent(n)}const ve=document.querySelectorAll(".dpad-btn");ve.forEach(e=>{const t=e.dataset.key||e.getAttribute("data-key");e.addEventListener("pointerdown",n=>{n.preventDefault(),B(t,"keydown")}),e.addEventListener("pointerup",n=>{n.preventDefault(),B(t,"keyup")}),e.addEventListener("pointerleave",n=>{n.preventDefault(),B(t,"keyup")}),e.addEventListener("lostpointercapture",n=>B(t,"keyup"))});const W=document.getElementById("bigTeleport");W&&W.addEventListener("pointerdown",e=>{e.preventDefault(),document.getElementById("teleBtn").click()});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});window.touchInput={up:!1,down:!1,left:!1,right:!1};function u(e,t){window.touchInput&&(window.touchInput[e]=!!t)}function P(e,t){const n=document.getElementById(e);n&&(n.addEventListener("pointerdown",a=>{a.preventDefault(),u(t,!0)}),n.addEventListener("pointerup",a=>{a.preventDefault(),u(t,!1)}),n.addEventListener("pointercancel",a=>{u(t,!1)}),n.addEventListener("pointerleave",a=>{u(t,!1)}),n.addEventListener("lostpointercapture",a=>{u(t,!1)}))}P("btnUp","up");P("btnLeft","left");P("btnDown","down");P("btnRight","right");window.addEventListener("blur",()=>{u("up",!1),u("down",!1),u("left",!1),u("right",!1)});
