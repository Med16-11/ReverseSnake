(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const g of a.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();const n={x:0,y:0,vx:0,vy:0,speed:220,radius:8},d={};function _(e){return(e||"").toString().toLowerCase()}window.addEventListener("keydown",e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)&&e.preventDefault(),d[_(e.key)]=!0});window.addEventListener("keyup",e=>{d[_(e.key)]=!1});function Y(e){n.x=e.width*.7,n.y=e.height*.5,n.vx=0,n.vy=0}function J(e,t){let o=0,l=0;(d.w||d.arrowup)&&(l=-1),(d.s||d.arrowdown)&&(l=1),(d.a||d.arrowleft)&&(o=-1),(d.d||d.arrowright)&&(o=1);const i=Math.hypot(o,l);i>0?(o/=i,l/=i,n.vx=o*n.speed,n.vy=l*n.speed):(n.vx*=.86,n.vy*=.86),n.x+=n.vx*e,n.y+=n.vy*e,n.x=Math.max(n.radius,Math.min(t.width-n.radius,n.x)),n.y=Math.max(n.radius,Math.min(t.height-n.radius,n.y))}let p=[];function $(e,t,o=6){const l=[];for(let i=0;i<o;i++)l.push({x:e-i*16,y:t+(Math.random()*6-3)});return{segments:l,baseSpeed:70,aggro:.18,predictT:.34}}function Q(e){p=[$(e.width*.3,e.height*.5,6)]}function Z(e,t,o,l){const i=Math.floor(o/6);for(;p.length<1+i;){const a=Math.random()*l.width*.6+20,g=Math.random()*l.height*.9+10;p.push($(a,g,6+Math.floor(o/3)))}p.forEach((a,g)=>{const h=a.segments[0],R=a.baseSpeed*(1+(o-1)*.12+g*.05),q=Math.max(.08,a.predictT-(o-1)*.015),D=Math.min(.36,a.aggro+(o-1)*.01),H=t.x+t.vx*q,X=t.y+t.vy*q;let b=H-h.x,P=X-h.y;const F=Math.hypot(b,P)||1;b/=F,P/=F,h.x+=b*R*e,h.y+=P*R*e,h.x=Math.max(12,Math.min(l.width-12,h.x)),h.y=Math.max(12,Math.min(l.height-12,h.y));for(let y=1;y<a.segments.length;y++){const N=a.segments[y-1],k=a.segments[y];k.x+=(N.x-k.x)*D,k.y+=(N.y-k.y)*D}if(Math.random()<.002+o*6e-4){const y=a.segments[a.segments.length-1];a.segments.push({x:y.x-6,y:y.y+2})}})}const s=document.getElementById("game"),r=s.getContext("2d");function W(){s.width=Math.max(600,window.innerWidth-360),s.height=window.innerHeight-60}window.addEventListener("resize",W);W();const ee=document.getElementById("score"),te=document.getElementById("level"),ne=document.getElementById("tleft"),oe=document.getElementById("snakes"),v=document.getElementById("levelPopup"),G=document.getElementById("popupLevel"),re=document.getElementById("popupCloseBtn");re.onclick=()=>O();let M=0,w=!1,f=!1,c=0,x=1,I=0,u=3;const K=3,ie=20;let m=0;function T(e){m=e}function z(){w=!0,f=!1,c=0,x=1,I=0,u=K,Y(s),Q(s),M=performance.now(),m=0,requestAnimationFrame(S)}function V(){if(!w)return;f=!f;const e=document.getElementById("pauseBtn");e.textContent=f?"Resume":"Pause",f||(M=performance.now(),requestAnimationFrame(S))}function j(){if(w&&!f){if(u<=0)return;for(let e=0;e<30;e++){const t={x:Math.random()*(s.width-60)+30,y:Math.random()*(s.height-60)+30};let o=!0;for(const l of p){for(const i of l.segments)if(Math.hypot(i.x-t.x,i.y-t.y)<70){o=!1;break}if(!o)break}if(o){n.x=t.x,n.y=t.y,n.vx=0,n.vy=0,u--,c=Math.max(0,c-6),T(.6),B();return}}n.x=Math.random()*(s.width-60)+30,n.y=Math.random()*(s.height-60)+30,u--,c=Math.max(0,c-6),T(.6),B();return}if(!w){if(u<=0)return;u--,n.x=Math.random()*(s.width-160)+80,n.y=Math.random()*(s.height-160)+80,n.vx=0,n.vy=0,c=Math.max(0,c-12),w=!0,f=!1,M=performance.now(),T(1),B(),requestAnimationFrame(S);return}}function S(e){if(!w||f)return;const t=Math.min(.05,(e-M)/1e3);M=e,ae(t),ce(),requestAnimationFrame(S)}function ae(e){if(I+=e,m>0&&(m=Math.max(0,m-e)),J(e,s),Z(e,n,x,s),m<=0)for(const t of p){const o=t.segments[0];if(Math.hypot(o.x-n.x,o.y-n.y)<16+n.radius){w=!1,le();return}}c+=e*12,I>=ie&&(I=0,se()),B()}function se(){x++,u=K,c+=60,de(x)}function le(){r.fillStyle="rgba(2,6,23,0.7)",r.fillRect(0,0,s.width,s.height),r.fillStyle="#fff",r.font="28px system-ui",r.textAlign="center",r.fillText("Game Over",s.width/2,s.height/2-10),r.font="16px system-ui",r.fillText(`Score: ${Math.floor(c)}  Level: ${x}`,s.width/2,s.height/2+20);try{const e=Number(localStorage.getItem("best")||0);Math.floor(c)>e&&localStorage.setItem("best",Math.floor(c))}catch{}}function B(){ee.textContent=Math.floor(c),te.textContent=x,ne.textContent=u,oe.textContent=p.length}function ce(){r.fillStyle="#071027",r.fillRect(0,0,s.width,s.height);const e=48;r.strokeStyle="rgba(255,255,255,0.02)",r.lineWidth=1;for(let t=0;t<s.width;t+=e)r.beginPath(),r.moveTo(t,0),r.lineTo(t,s.height),r.stroke();for(let t=0;t<s.height;t+=e)r.beginPath(),r.moveTo(0,t),r.lineTo(s.width,t),r.stroke();for(const t of p)for(let o=t.segments.length-1;o>=0;o--){const l=t.segments[o],i=o/Math.max(1,t.segments.length-1),a=12-i*6;r.beginPath(),r.fillStyle=o===0?"rgb(239,71,111)":`rgba(${Math.floor(40+140*(1-i))},${Math.floor(60+150*i)},${Math.floor(30+40*(1-i))},1)`,r.arc(l.x,l.y,a,0,Math.PI*2),r.fill()}if(r.fillStyle="#ffd166",r.beginPath(),r.arc(n.x,n.y,n.radius,0,Math.PI*2),r.fill(),m>0){const t=.12+.12*Math.sin(m*30);r.globalAlpha=t,r.beginPath(),r.arc(n.x,n.y,n.radius*3.6,0,Math.PI*2),r.fill(),r.globalAlpha=1}else r.globalAlpha=.14,r.beginPath(),r.arc(n.x,n.y,n.radius*3.6,0,Math.PI*2),r.fill(),r.globalAlpha=1}function de(e){G.textContent=e,v.classList.remove("hidden"),requestAnimationFrame(()=>v.classList.add("show")),setTimeout(()=>O(),4200)}function O(){v.classList.remove("show"),setTimeout(()=>v.classList.add("hidden"),260)}function E(){const e=new URL(window.location.href);return e.searchParams.set("level",String(x)),e.searchParams.set("score",String(Math.floor(c))),e.toString()}function he(){const e=new URLSearchParams(window.location.search),t=e.get("level"),o=e.get("score");if(t||o){const l=document.getElementById("shareInput");l&&(l.value=window.location.href),G.textContent=t||"—",v.classList.remove("hidden"),v.classList.add("show"),setTimeout(()=>O(),4200)}}window.__gameAPI={startGame:z,teleport:j,togglePause:V,getShareLinkFromState:E};const ue=document.getElementById("startBtn"),fe=document.getElementById("pauseBtn"),me=document.getElementById("teleBtn"),A=document.getElementById("copyBtn"),pe=document.getElementById("openShareBtn"),ge=document.getElementById("shareInput"),C=document.getElementById("popupShareBtn");ue.onclick=()=>z();fe.onclick=()=>V();me.onclick=()=>j();A.onclick=async()=>{try{const e=E();await navigator.clipboard.writeText(e),A.textContent="Copied ✓",setTimeout(()=>A.textContent="Copy link",1500)}catch(e){console.warn("copy failed",e)}};pe.onclick=()=>{const e=E();window.open(e,"_blank")};C.onclick=async()=>{const e=E();try{await navigator.clipboard.writeText(e),C.textContent="Copied ✓",setTimeout(()=>C.textContent="Share Level",1500)}catch(t){console.warn(t)}};setInterval(()=>{try{ge.value=E()}catch{}},400);he();document.querySelector("canvas").addEventListener("click",()=>window.focus());function L(e,t="keydown"){const o=new KeyboardEvent(t,{key:e});window.dispatchEvent(o)}const ye=document.querySelectorAll(".dpad-btn");ye.forEach(e=>{const t=e.dataset.key||e.getAttribute("data-key");e.addEventListener("pointerdown",o=>{o.preventDefault(),L(t,"keydown")}),e.addEventListener("pointerup",o=>{o.preventDefault(),L(t,"keyup")}),e.addEventListener("pointerleave",o=>{o.preventDefault(),L(t,"keyup")}),e.addEventListener("lostpointercapture",o=>L(t,"keyup"))});const U=document.getElementById("bigTeleport");U&&U.addEventListener("pointerdown",e=>{e.preventDefault(),document.getElementById("teleBtn").click()});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
